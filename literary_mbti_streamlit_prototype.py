# literary_mbti_streamlit_full.py
# Streamlit app for "æ–‡å­¦ MBTI" questionnaire with full questions and 16 profiles
# Run: streamlit run literary_mbti_streamlit_full.py

import streamlit as st
import pandas as pd
import json
from datetime import datetime

st.set_page_config(page_title="æ–‡å­¦ MBTI æµ‹è¯•", layout="centered")

# ------------------------------------
# é¢˜ç›®é…ç½®ï¼šæ¥è‡ªä½ çš„ DOCX æ–‡ä»¶ï¼ˆæ¯ç»´åº¦ 5 é¢˜ï¼‰
# ------------------------------------
QUESTIONS = []

def add_questions(axis, qlist):
    for i, (text, A, B) in enumerate(qlist, 1):
        QUESTIONS.append({
            "id": f"{axis}{i}",
            "text": text,
            "axis": axis,
            "options": [(A, axis[0]), (B, axis[1])]
        })

# ç„¦ç‚¹å–å‘ - æƒ…èŠ‚é©±åŠ¨ (E) vs. å†…å¿ƒä¸–ç•Œ (I)
add_questions("EI", [
    ("å½“ä½ å‘æœ‹å‹æ¨èä¸€æœ¬ä¹¦æ—¶ï¼Œä½ æœ€å…ˆæè¿°çš„æ˜¯ä»€ä¹ˆï¼Ÿ", "æƒ…èŠ‚å¤šä¹ˆæ›²æŠ˜ç¦»å¥‡", "è§’è‰²å†…å¿ƒæŒ£æ‰å¤šä¹ˆæ·±åˆ»"),
    ("ä»€ä¹ˆæ ·çš„å†²çªæ›´èƒ½å¸å¼•ä½ ï¼Ÿ", "å¤–éƒ¨å¯¹æŠ—ã€æˆ˜äº‰æˆ–è¿½æ•", "äººç‰©å†…åœ¨çš„é“å¾·å›°å¢ƒ"),
    ("ä¼Ÿå¤§å°è¯´çš„æ ¸å¿ƒé©±åŠ¨åŠ›æ˜¯ä»€ä¹ˆï¼Ÿ", "æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ", "è¿™ä¸ªäººä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ"),
    ("å‰50é¡µéƒ½æ˜¯æ—¥å¸¸æå†™ï¼Œä½ ä¼šï¼Ÿ", "æ„Ÿåˆ°ä¹å‘³ï¼ŒæœŸå¾…äº‹ä»¶å‘ç”Ÿ", "äº«å—ç»†èŠ‚ï¼Œç†è§£äººç‰©ç”Ÿæ´»"),
    ("ä½ æ›´å–œæ¬¢ä»€ä¹ˆæ ·çš„å™äº‹èŠ‚å¥ï¼Ÿ", "ç´§å‡‘è¿…æ·ï¼Œä¿¡æ¯é‡å¤§", "èˆ’ç¼“æ·±å…¥ï¼Œåœç•™åœ¨æƒ…ç»ªä¸­"),
])

# é£æ ¼å–å‘ - ç°å®ä¸»ä¹‰ (S) vs. æƒ³è±¡ä¸»ä¹‰ (N)
add_questions("SN", [
    ("ä»€ä¹ˆæ ·çš„æ–°ä¸–ç•Œæ›´è®©ä½ å…´å¥‹ï¼Ÿ", "çœŸå®å­˜åœ¨çš„å†å²æ—¶ä»£", "å®Œå…¨è™šæ„çš„ä¸–ç•Œ"),
    ("ä»€ä¹ˆæ ·çš„æ¯”å–»æ›´æ‰“åŠ¨ä½ ï¼Ÿ", "å¸¸è§äº‹ç‰©çš„ç²¾å¦™ç±»æ¯”", "æŠ½è±¡è€Œå¯Œæœ‰æƒ³è±¡åŠ›çš„è”ç»“"),
    ("å¦‚ä½•çœ‹å¾…é­”æ³•æˆ–è¶…ç°å®å…ƒç´ ï¼Ÿ", "ä¼šåˆ†æ•£æ³¨æ„åŠ›", "æ˜¯è¡¨è¾¾æ€æƒ³çš„éšå–»å·¥å…·"),
    ("é˜…è¯»æ—¶ï¼Œä»€ä¹ˆæ ·çš„ç»†èŠ‚æœ€è®©ä½ ä¿¡æœï¼Ÿ", "çœŸå®çš„ç¤¾ä¼šç»†èŠ‚", "è™šæ„ä¸–ç•Œè§‚çš„è‡ªæ´½æ€§"),
    ("å¦‚æœä¸€æœ¬ä¹¦è¢«è¯„ä»·ä¸ºæ–‡ç¬”è¯—æ„ï¼Œä½ ä¼šï¼Ÿ", "æ‹…å¿ƒçŸ«æ‰é€ ä½œ", "æœŸå¾…å…¶ç¾æ„Ÿ"),
])

# å†³ç­–å–å‘ - é€»è¾‘æ¶æ„ (T) vs. æƒ…æ„Ÿå…±é¸£ (F)
add_questions("TF", [
    ("ä¸€ä¸ªè§’è‰²çš„è¡Œä¸ºï¼Œä½ æ›´çœ‹é‡ä»€ä¹ˆï¼Ÿ", "é€»è¾‘åˆç†", "æƒ…æ„Ÿå†²å‡»"),
    ("ä»€ä¹ˆæ ·çš„ä¸»é¢˜æ›´èƒ½å¼•å‘ä½ çš„æ€è€ƒï¼Ÿ", "å“²å­¦æ¢è®¨", "æƒ…æ„Ÿå‘½é¢˜"),
    ("å¦‚ä½•åˆ¤æ–­åæ´¾æ˜¯å¦æˆåŠŸï¼Ÿ", "åŠ¨æœºæ¸…æ™°ä¸”æ¨åŠ¨å‰§æƒ…", "è®©äººç†è§£å…¶ç—›è‹¦"),
    ("è¯»å®Œä¸€æœ¬ä¹¦åï¼Œä½ å€¾å‘è®¨è®ºä»€ä¹ˆï¼Ÿ", "å™äº‹ç»“æ„ä¸æ€æƒ³", "äººç‰©å‘½è¿ä¸æ„Ÿå—"),
    ("ç»“å±€åˆç†æ„å‘³ç€ä»€ä¹ˆï¼Ÿ", "é€»è¾‘å¿…ç„¶", "æƒ…æ„Ÿåœ†æ»¡"),
])

# æ€åº¦å–å‘ - é—­åˆç»“å±€ (J) vs. å¼€æ”¾è¯ é‡Š (P)
add_questions("JP", [
    ("çœ‹åˆ°å¹¸ç¦ç”Ÿæ´»ç»“å°¾ï¼Œä½ æ„Ÿè§‰å¦‚ä½•ï¼Ÿ", "æ»¡æ„å®‰å¿ƒ", "æƒ³çŸ¥é“æ›´å¤šæŒ‘æˆ˜"),
    ("é¢å¯¹å¯å¤šé‡è§£è¯»çš„å°è¯´ï¼Œä½ è®¤ä¸ºï¼Ÿ", "ä½œè€…æ„å›¾ä¸æ¸…", "æ–‡å­¦çš„é­…åŠ›æ‰€åœ¨"),
    ("æ›´å–œæ¬¢å“ªç§å™äº‹ç»“æ„ï¼Ÿ", "çº¿æ€§å™äº‹", "ç¢ç‰‡åŒ–å¤šè§†è§’å™äº‹"),
    ("ç»“å±€æ˜¯ä¸»è§’èµ°å‘æœªçŸ¥æœªæ¥æ—¶ï¼Œä½ ä¼šï¼Ÿ", "å¤±è½ï¼Œæƒ³è¦ç¡®å®šç­”æ¡ˆ", "å…´å¥‹ï¼Œæƒ³è±¡å„ç§æœªæ¥"),
    ("æ•…äº‹ç»“å°¾çš„ä½œç”¨ï¼Ÿ", "æ”¶æŸä¸äº¤ä»£", "å¼€å¯æ–°çš„æ€è€ƒ"),
])

# ------------------------------------
# MBTI ç»“æœæ•°æ®ï¼š16å‹æè¿° + æ¨èä¹¦å•
# ------------------------------------
MBTI_PROFILES = {
    "ESTJ": {"title": "æ¶æ„è§£å¯†è€…", "description": "ä½ ç—´è¿·äºâ€œæƒ…èŠ‚é€»è¾‘é—­ç¯â€ï¼Œå–œæ¬¢æ‰æ ¹ç°å®ã€æ— æ¼æ´çš„æ•…äº‹â€”â€”æ—¢è¦æœ‰ç´§å‡‘çš„å¤–éƒ¨äº‹ä»¶ï¼Œåˆè¦ç¬¦åˆç°å®è§„åˆ™ï¼Œæœ€ç»ˆç»“å±€å¿…é¡»æ˜¯æƒ…èŠ‚ä¸äººç‰©åŠ¨æœºçš„å¿…ç„¶ç»“æœã€‚", "kind":["ä¾¦æ¢/æ¨ç†å°è¯´å’Œé€»è¾‘ç¼œå¯†çš„å†å²æ‚¬ç–‘å°è¯´"],"books": ["ã€Šæ¸…æ˜ä¸Šæ²³å›¾å¯†ç ã€‹", "ã€Šä¸œæ–¹å¿«è½¦è°‹æ€æ¡ˆã€‹", "ã€Šåå°å­©ã€‹"]},

    "ENTJ": {"title": "ä¸–ç•Œè§„åˆ™æŒæ§è€…", "description": "ä½ äº«å—â€œè™šæ„ä¸–ç•Œé‡Œçš„ä¸¥è°¨é€»è¾‘â€â€”â€”åçˆ±æœ‰å®Œæ•´è®¾å®šçš„æ•…äº‹ï¼Œæƒ…èŠ‚è¦ç´§å‡‘ï¼Œä¸”æ‰€æœ‰äº‹ä»¶éƒ½è¦ç¬¦åˆè¿™ä¸ªä¸–ç•Œçš„â€œè‡ªå®šè§„åˆ™â€ï¼Œç»“å±€å¿…é¡»æ¸…æ™°äº¤ä»£å†²çªè§£å†³æ–¹å¼","kind":["ç¡¬ç§‘å¹»å°è¯´ã€è§„åˆ™ä¸¥è°¨çš„å²è¯—å¥‡å¹»ã€é«˜æ¦‚å¿µè®¾å®šæ¨ç†"], "books": ["ã€Šä¸‰ä½“ã€‹", "ã€ŠåŸºåœ°ã€‹", "ã€Šæ²™ä¸˜ã€‹"]},

    "ISTJ": {"title": "äººæ€§é€»è¾‘è§‚å¯Ÿè€…", "description": "ä½ å…³æ³¨â€œç°å®äººç‰©çš„å¿ƒç†é€»è¾‘â€â€”â€”ä¸è¿½æ±‚å¼ºæƒ…èŠ‚ï¼Œæ›´çˆ±é€šè¿‡æ—¥å¸¸ç»†æŒ–æ˜äººç‰©å†…å¿ƒï¼Œä¸”äººç‰©çš„å¿ƒç†è½¬å˜å¿…é¡»ç¬¦åˆç°å®é€»è¾‘ï¼Œç»“å±€è¦æ˜ç¡®äº¤ä»£äººç‰©çš„æœ€ç»ˆé€‰æ‹©", "kind":["ç°å®å‘å¿ƒç†å°è¯´ã€å®¶åº­ä¼¦ç†å°è¯´ã€ç»†è…»æ´¾ç¤¾ä¼šå†™å®ä½œå“"],"books": ["ã€Šæ´»ç€ã€‹", "ã€ŠåŒ…æ³•åˆ©å¤«äººã€‹", "ã€Šäººä¸–é—´ã€‹"]},

    "INTJ": {"title": "éšå–»é€»è¾‘è§£è¯»å¸ˆ", "description": "ä½ å–œæ¬¢â€œç”¨è™šæ„å¤–å£³å‰–æå¿ƒç†é€»è¾‘â€â€”â€”æ•…äº‹å¯ä»¥æœ‰å¥‡å¹»/ç§‘å¹»å…ƒç´ ï¼Œä½†æ ¸å¿ƒæ˜¯æŒ–æ˜äººç‰©å†…å¿ƒï¼Œä¸”äººç‰©å¿ƒç†å˜åŒ–è¦ç¬¦åˆâ€œéšå–»é€»è¾‘â€ï¼Œç»“å±€éœ€æ˜ç¡®äººç‰©çš„è‡ªæˆ‘å’Œè§£/è®¤çŸ¥ã€‚", "kind":["éšå–»å‹ç§‘å¹»/å¥‡å¹»ã€å¿ƒç†å‘å¯“è¨€å°è¯´ã€è®¾å®šæœåŠ¡äºäººç‰©çš„ä½œå“"],"books": ["ã€Šå…‹æ‹‰æ‹‰ä¸å¤ªé˜³ã€‹", "ã€Šå¤±æ˜ç—‡æ¼«è®°ã€‹", "ã€Šè‡ç‹ã€‹"]},

    "ESTP": {"title": "ç°å®è°œé¢˜æ¢ç´¢è€…", "description": "ä½ äº«å—â€œç°å®æƒ…èŠ‚çš„é€»è¾‘ç•™ç™½â€â€”â€”å–œæ¬¢åŸºäºç°å®çš„æ‚¬ç–‘/æ¢æ¡ˆæ•…äº‹ï¼Œæƒ…èŠ‚è¦ç´§å‡‘ä¸”ç¬¦åˆç°å®é€»è¾‘ï¼Œå¯è®©ç»“å±€ç•™ä¸‹â€œæ€æƒ³å±‚é¢çš„å¼€æ”¾â€ï¼Œé‡ç‚¹æ˜¯é€šè¿‡é€»è¾‘æ¨ç†è¿‡ç¨‹å¼•å‘å¯¹ç°å®çš„æ€è€ƒ","kind":["ç¤¾ä¼šæ´¾æ¨ç†å°è¯´ã€ç°å®å‘æ‚¬ç–‘å°è¯´ã€é€»è¾‘ä¸¥è°¨çš„â€œé—®é¢˜å°è¯´â€"], "books": ["ã€Šç™½å¤œè¡Œã€‹", "ã€Šå±€å¤–äººã€‹", "ã€Šé•¿å¤œéš¾æ˜ã€‹"]},

    "ENTP": {"title": "è®¾å®šè°œé¢˜æ€è¾¨è€…", "description": "ä½ åçˆ±â€œè™šæ„è®¾å®šçš„é€»è¾‘å»¶ä¼¸â€â€”â€”å–œæ¬¢æœ‰åˆ›æ–°è®¾å®šçš„æ•…äº‹ï¼Œæƒ…èŠ‚è¦å›´ç»•è®¾å®šå±•å¼€ï¼Œç»“å±€å¯ä»¥ä¸â€œè§£å†³æ‰€æœ‰é—®é¢˜â€ï¼Œä½†å¿…é¡»åœ¨ç°æœ‰é€»è¾‘å†…è‡ªæ´½ï¼Œé‡ç‚¹æ˜¯å¼•å‘å¯¹è®¾å®šèƒŒåæ€æƒ³çš„è®¨è®ºã€‚", "kind":["æ€è¾¨å‹ç¡¬ç§‘å¹»ã€è®¾å®šå¼€æ”¾çš„å¥‡å¹»æ¨ç†ã€é«˜æ¦‚å¿µæ€æƒ³å°è¯´"],"books": ["ã€Šä½ ä¸€ç”Ÿçš„æ•…äº‹ã€‹", "ã€Šç¯å½¢ä½¿è€…ã€‹", "ã€Šé»‘æš—çš„å·¦æ‰‹ã€‹"]},

    "ISTP": {"title": "äººæ€§æ€è€ƒè€…", "description": "ä½ å…³æ³¨â€œç°å®äººç‰©çš„å¿ƒç†ç•™ç™½â€â€”â€”å–œæ¬¢é€šè¿‡æ—¥å¸¸ç»†èŠ‚åˆ»ç”»äººç‰©å†…å¿ƒï¼Œäººç‰©å¿ƒç†å˜åŒ–ç¬¦åˆç°å®é€»è¾‘ï¼Œä½†ä¸ä»‹æ„ç»“å±€ç•™ä¸‹â€œäººç‰©æœªæ¥çš„å¼€æ”¾â€ï¼Œé‡ç‚¹æ˜¯é€šè¿‡å¿ƒç†é€»è¾‘å¼•å‘å¯¹äººæ€§çš„æ€è€ƒ", "kind":["ç°å®å‘å¿ƒç†æ•£æ–‡å°è¯´ã€ç»†è…»æ´¾æˆé•¿å°è¯´ã€äººç‰©å¯¼å‘çš„â€œåˆ‡ç‰‡å¼â€ä½œå“"],"books": ["ã€ŠæŒªå¨çš„æ£®æ—ã€‹", "ã€Šæ–¯é€šçº³ã€‹", "ã€Šå±±èŒ¶æ–‡å…·åº—ã€‹"]},

    "INTP": {"title": "éšå–»å¿ƒç†æ€è¾©è€…", "description": "ä½ å–œæ¬¢â€œè™šæ„éšå–»çš„å¿ƒç†ç•™ç™½â€â€”â€”æ•…äº‹å¯ä»¥æœ‰å¥‡å¹»/ç§‘å¹»å…ƒç´ ï¼Œæ ¸å¿ƒæ˜¯æŒ–æ˜äººç‰©å†…å¿ƒï¼Œä¸”å¿ƒç†å˜åŒ–ç¬¦åˆéšå–»é€»è¾‘ï¼Œç»“å±€å¯ä»¥ä¸â€œå®Œæˆè‡ªæˆ‘å’Œè§£â€ï¼Œé‡ç‚¹æ˜¯é€šè¿‡éšå–»å¼•å‘å¯¹å†…å¿ƒä¸–ç•Œçš„æ€è¾¨ã€‚", "kind":["éšå–»å‹å¿ƒç†å¥‡å¹»ã€æ€è¾¨å‘ç§‘å¹»å°è¯´ã€è®¾å®šæœåŠ¡äºå¿ƒç†çš„ä½œå“"],"books": ["ã€Šæµ·æµªã€‹", "ã€Šæ ‘ä¸Šçš„ç”·çˆµã€‹", "ã€Šä½©å¾·ç½—Â·å·´æ‹‰è«ã€‹"]},

    "ESFJ": {"title": "ç°å®æƒ…æ„Ÿè¿½éšè€…", "description": "ä½ æ²‰è¿·äºâ€œç°å®æƒ…èŠ‚ä¸­çš„æƒ…æ„Ÿé—­ç¯â€â€”â€”å–œæ¬¢æœ‰ç´§å‡‘å¤–éƒ¨äº‹ä»¶çš„ç°å®æ•…äº‹ï¼Œé‡ç‚¹æ˜¯äº‹ä»¶å¼•å‘çš„äººç‰©æƒ…æ„Ÿå˜åŒ–ï¼Œç»“å±€å¿…é¡»è®©æƒ…æ„Ÿå¾—åˆ°æ˜ç¡®å®‰æ”¾ã€‚","kind":["ç°å®å‘æƒ…æ„Ÿå°è¯´ã€å®¶åº­å²è¯—ã€æ¸©æš–ç³»å†’é™©å°è¯´"], "books": ["ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹", "ã€Šå±±èŒ¶æ–‡å…·åº—ã€‹", "ã€Šå¤ºå®å¥‡å…µã€‹"]},

    "ENFJ": {"title": "å¥‡å¹»æƒ…æ„Ÿå®ˆæŠ¤è€…", "description": "ä½ äº«å—â€œè™šæ„æƒ…èŠ‚ä¸­çš„æƒ…æ„Ÿåœ†æ»¡â€â€”â€”åçˆ±æœ‰å¥‡å¹»/ç§‘å¹»è®¾å®šçš„ç´§å‡‘æ•…äº‹ï¼Œæ ¸å¿ƒæ˜¯äººç‰©åœ¨è™šæ„äº‹ä»¶ä¸­çš„æƒ…æ„Ÿè”ç»“ï¼Œç»“å±€å¿…é¡»è®©æƒ…æ„Ÿå¾—åˆ°æ˜ç¡®åœ†æ»¡ï¼ŒæœåŠ¡äºæƒ…æ„Ÿè¡¨è¾¾ã€‚", "kind":["æƒ…æ„Ÿå‘å¥‡å¹»å°è¯´ã€æ¸©æš–ç³»ç§‘å¹»ã€å†’é™©å‘ç«¥è¯æ”¹ç¼–"],"books": ["ã€Šéœæ¯”ç‰¹äººã€‹", "ã€Šå°‘å¹´Piçš„å¥‡å¹»æ¼‚æµã€‹", "ã€Šæ˜Ÿå°˜ã€‹"]},

    "ISFJ": {"title": "äººé—´æ¸©æƒ…è®°å½•è€…", "description": "ä½ æ²‰é†‰äºâ€œç°å®æ—¥å¸¸é‡Œçš„æƒ…æ„Ÿæ²‰æ·€â€â€”â€”ä¸è¿½æ±‚å¼ºæƒ…èŠ‚ï¼Œæ›´çˆ±é€šè¿‡å¹³å‡¡ç”Ÿæ´»ç»†èŠ‚æ•æ‰äººç‰©ç»†è…»æƒ…æ„Ÿï¼Œäººç‰©æƒ…æ„Ÿå˜åŒ–çœŸå®å¯æ„Ÿï¼Œçœ‹é‡â€œç”Ÿæ´»æœ¬èº«çš„æƒ…æ„Ÿåœ†æ»¡â€ã€‚","kind":["æ—¥å¸¸å‘æ¸©æƒ…å°è¯´ã€å®¶åº­çäº‹çºªå®å°è¯´ã€ç»†è…»æ´¾é‚»é‡Œ/èŒåœºæƒ…æ„Ÿä½œå“"], "books": ["ã€Šä½è´ºçš„è¶…çº§é˜¿å¬·ã€‹", "ã€Šæ·±å¤œé£Ÿå ‚ã€‹", "ã€Šæˆ‘ä»¬ä»¨ã€‹"]},

    "INFJ": {"title": "å¥‡å¹»å¿ƒçµæ²»æ„ˆè€…", "description": "ä½ åçˆ±â€œè™šæ„è®¾å®šä¸‹çš„æƒ…æ„Ÿå’Œè§£â€â€”â€”æ•…äº‹å¯ä»¥æœ‰å¥‡å¹»/ç§‘å¹»å…ƒç´ ï¼Œä½†æ ¸å¿ƒæ˜¯æŒ–æ˜äººç‰©å†…å¿ƒçš„æƒ…æ„Ÿå›°å¢ƒï¼Œè™šæ„è®¾å®šä¸ºæƒ…æ„Ÿè¡¨è¾¾æœåŠ¡ï¼Œçœ‹é‡â€œå¿ƒçµå±‚é¢çš„åœ†æ»¡â€ã€‚", "kind":["æ²»æ„ˆç³»å¥‡å¹»å°è¯´ã€æƒ…æ„Ÿå‘å¯“è¨€æ•…äº‹ã€è®¾å®šæœåŠ¡äºå¿ƒç†æ²»æ„ˆçš„ä½œå“"],"books": ["ã€Šå°ç‹å­ã€‹", "ã€Šæµ·æ´‹ä¹‹æ­Œã€‹", "ã€Šä½ åœ¨å¤©å ‚é‡Œé‡è§çš„äº”ä¸ªäººã€‹"]},

    "ESFP": {"title": "ç°å®æƒ…æ„Ÿæ¼«æ¸¸è€…", "description": "ä½ äº«å—â€œç°å®æƒ…èŠ‚ä¸­çš„æƒ…æ„Ÿåˆ‡ç‰‡â€â€”â€”å–œæ¬¢æœ‰é²œæ´»å¤–éƒ¨äº‹ä»¶çš„ç°å®æ•…äº‹ï¼Œé‡ç‚¹æ˜¯äº‹ä»¶ä¸­è¿¸å‘çš„å³æ—¶æƒ…æ„Ÿï¼Œæƒ…èŠ‚ç´§å‡‘ä½†ä¸è¿½æ±‚â€œæœ€ç»ˆåœ†æ»¡â€ï¼Œçœ‹é‡â€œæƒ…æ„Ÿä½“éªŒçš„çœŸå®æ„Ÿ", "kind":["å…¬è·¯å°è¯´ã€éƒ½å¸‚æƒ…æ„Ÿåˆ‡ç‰‡å°è¯´ã€ç°å®å‘å†’é™©çŸ­ç¯‡é›†"],"books": ["ã€Šæ¼«é•¿çš„å‘Šåˆ«ã€‹", "ã€Šå¥¥å‰Â·é©¬å¥‡å†é™©è®°ã€‹", "ã€Šé£è¡Œå®¶ã€‹"]},

    "ENFP": {"title": "å¥‡å¹»æƒ…æ„Ÿæ¢ç´¢è€…", "description": "ä½ ç—´è¿·äºâ€œè™šæ„æƒ…èŠ‚ä¸­çš„æƒ…æ„Ÿå¯èƒ½â€â€”â€”åçˆ±æœ‰å¥‡å¹»/ç§‘å¹»è®¾çš„çµåŠ¨æ•…äº‹ï¼Œæ ¸å¿ƒæ˜¯äººç‰©åœ¨è™šæ„äº‹ä»¶ä¸­é‡åˆ°çš„å¤šå…ƒæƒ…æ„Ÿï¼Œæƒ…èŠ‚è½»å¿«ï¼Œç»“å±€å¯ä»¥ç•™ä¸‹æƒ…æ„Ÿå»¶ä¼¸ï¼Œçœ‹é‡â€œæƒ…æ„Ÿæ¢ç´¢çš„æ–°é²œæ„Ÿâ€ã€‚", "kind":["è½»å¥‡å¹»å†’é™©å°è¯´ã€è„‘æ´å‘æƒ…æ„Ÿæ•…äº‹ã€è®¾å®šçµåŠ¨çš„çŸ­ç¯‡é›†"],"books": ["ã€Šé“¶æ²³ç³»æ¼«æ¸¸æŒ‡å—ã€‹", "ã€Šçˆ±ä¸½ä¸æ¢¦æ¸¸ä»™å¢ƒã€‹", "ã€Šå¤œæ™šçš„æ½œæ°´è‰‡ã€‹"]},

    "ISFP": {"title": "ç”Ÿæ´»æƒ…ç»ªæ•æ‰è€…", "description": "ä½ å…³æ³¨â€œç°å®æ—¥å¸¸é‡Œçš„æƒ…æ„Ÿä½™éŸµâ€â€”â€”ä¸å–œæ¬¢å¼ºæƒ…èŠ‚ï¼Œæ›´çˆ±é€šè¿‡ç»†å¾®åœºæ™¯æ•æ‰äººç‰©çš„éšç§˜æƒ…ç»ªï¼Œç»“å±€ç•™ä¸‹æƒ…æ„Ÿä½™éŸµï¼Œçœ‹é‡â€œæƒ…ç»ªä½“éªŒçš„ç»†è…»æ„Ÿâ€ã€‚","kind":["æ•£æ–‡åŒ–ç°å®å°è¯´ã€æƒ…ç»ªå‘çŸ­ç¯‡é›†ã€æ—¥å¸¸æ„Ÿç§å°è¯´"], "books": ["ã€Šå¤éƒ½ã€‹", "ã€Šæƒ…äººã€‹", "ã€Šç§‹å›­ã€‹"]},

    "INFP": {"title": "å¹»æ¢¦æƒ…æ„Ÿæ²‰æ€è€…", "description": "ä½ æ²‰é†‰äºâ€œè™šæ„æ„è±¡é‡Œçš„æƒ…æ„Ÿå“²æ€â€â€”â€”æ•…äº‹å¤šæœ‰è¯—æ„çš„å¥‡å¹»/è±¡å¾å…ƒç´ ï¼Œæ ¸å¿ƒæ˜¯äººç‰©åœ¨è™šæ„æ„è±¡ä¸­æ¢ç´¢æ·±å±‚æƒ…æ„Ÿï¼Œæƒ…æ„Ÿè¡¨è¾¾åå‘â€œå“²ç†æ€§â€ï¼Œç•™ä¸‹å¯¹æƒ…æ„Ÿæœ¬è´¨çš„æ²‰æ€ï¼Œçœ‹é‡â€œæƒ…æ„Ÿä¸æ€æƒ³çš„è”ç»“â€ã€‚", "kind":["è¯—æ„å¥‡å¹»å°è¯´ã€è±¡å¾ä¸»ä¹‰æƒ…æ„Ÿä½œå“ã€å“²æ€å‘å¯“è¨€æ•…äº‹"],"books": ["ã€Šæµ·æµªã€‹", "ã€Šé˜¿è±å¤«ã€‹", "ã€Šä½©å¾·ç½—Â·å·´æ‹‰è«ã€‹"]},
}

# ------------------------------------
# è®¡ç®—å‡½æ•°
# ------------------------------------

def compute_mbti(answers):
    axis_map = {"EI": {"E": 0, "I": 0}, "SN": {"S": 0, "N": 0}, "TF": {"T": 0, "F": 0}, "JP": {"J": 0, "P": 0}}
    for q in QUESTIONS:
        val = answers.get(q['id'])
        if val in axis_map[q['axis']]:
            axis_map[q['axis']][val] += 1
    mbti = ''.join([
        'E' if axis_map['EI']['E'] >= axis_map['EI']['I'] else 'I',
        'S' if axis_map['SN']['S'] >= axis_map['SN']['N'] else 'N',
        'T' if axis_map['TF']['T'] >= axis_map['TF']['F'] else 'F',
        'J' if axis_map['JP']['J'] >= axis_map['JP']['P'] else 'P',
    ])
    return mbti, axis_map

# ------------------------------------
# UI éƒ¨åˆ†
# ------------------------------------

st.title("ğŸ“š æ–‡å­¦ MBTI æµ‹è¯•")
st.write("å›ç­”ä»¥ä¸‹ 20 ä¸ªé—®é¢˜ï¼Œçœ‹çœ‹ä½ æ˜¯å“ªç§æ–‡å­¦ç±»å‹ï¼")

with st.form(key='mbti_form'):
    answers = {}
    cnt = 0
    PLACEHOLDER = "â€”â€” è¯·é€‰æ‹© â€”â€”"
    for idx, q in enumerate(QUESTIONS, start=1):
        cnt = idx
        st.write(f"**{cnt}.{q['text']}**")

        # ä½¿ç”¨å ä½é€‰é¡¹ä½¿å¾—æ‰“å¼€é¡µé¢æ—¶çœ‹èµ·æ¥åƒ "æœªé€‰æ‹©"
        labels = [PLACEHOLDER] + [opt[0] for opt in q['options']]
        choice = st.selectbox("", labels, key=q['id'])

        # å°†é€‰é¡¹æ–‡æœ¬æ˜ å°„ä¸ºè½´ä¸Šçš„å€¼ï¼ˆå¦‚ 'E' / 'I'ï¼‰
        label_to_val = {opt[0]: opt[1] for opt in q['options']}
        if choice == PLACEHOLDER:
            chosen_value = None
        else:
            chosen_value = label_to_val.get(choice)

        answers[q['id']] = chosen_value
        st.divider()
    submitted = st.form_submit_button("æäº¤å¹¶æŸ¥çœ‹ç»“æœ")

if submitted:
    # æ ¡éªŒæ˜¯å¦æœ‰æœªå¡«é¢˜ç›®
    unanswered = [i+1 for i, q in enumerate(QUESTIONS) if answers.get(q['id']) is None]
    if unanswered:
        st.error("ä»¥ä¸‹é¢˜ç›®æœªå¡«å†™ï¼Œè¯·å®Œæˆåå†æäº¤ï¼š" + 'ï¼Œ'.join([f"ç¬¬{n}é¢˜" for n in unanswered]))
    else:
        mbti, breakdown = compute_mbti(answers)
        st.success(f"ä½ çš„æ–‡å­¦ MBTI ç±»å‹æ˜¯ï¼š**{mbti}**")
        profile = MBTI_PROFILES.get(mbti)
        if profile:
            st.header(profile['title'])
            st.write(profile['description'])
            st.write("**åå¥½ç±»å‹ï¼š** " + 'ï¼Œ'.join(profile['kind']))
            st.write("**æ¨èä¹¦ç›®ï¼š**")
            for book in profile['books']:
                st.write(f"- {book}")
        else:
            st.warning("æš‚æ— è¯¥ç±»å‹çš„è¯¦ç»†ä¿¡æ¯ã€‚")

        # æ”¹è¿›ç‰ˆï¼šæ›´æ¸…æ™°çš„ç»´åº¦è®¡åˆ†æ˜¾ç¤º
        # ------------------------------------
        st.write("---")
        st.subheader("ç»´åº¦è®¡åˆ†ç»“æœ")

        axis_labels = {
            "EI": "ç„¦ç‚¹å–å‘ï¼ˆE: æƒ…èŠ‚é©±åŠ¨ / I: å†…å¿ƒä¸–ç•Œï¼‰",
            "SN": "é£æ ¼å–å‘ï¼ˆS: ç°å®ä¸»ä¹‰ / N: æƒ³è±¡ä¸»ä¹‰ï¼‰",
            "TF": "å†³ç­–å–å‘ï¼ˆT: é€»è¾‘æ¶æ„ / F: æƒ…æ„Ÿå…±é¸£ï¼‰",
            "JP": "æ€åº¦å–å‘ï¼ˆJ: é—­åˆç»“å±€ / P: å¼€æ”¾è¯ é‡Šï¼‰"
        }

        for axis, scores in breakdown.items():
            left_key, right_key = list(scores.keys())
            left_score = scores[left_key]
            right_score = scores[right_key]

            # é«˜äº®å½“å‰å€¾å‘
            if left_score > right_score:
                tendency = left_key
                tendency_label = f"**{left_key} å‹å€¾å‘æ›´æ˜æ˜¾**"
            elif right_score > left_score:
                tendency = right_key
                tendency_label = f"**{right_key} å‹å€¾å‘æ›´æ˜æ˜¾**"
            else:
                tendency = "å¹³è¡¡"
                tendency_label = "ä¸¤è€…å€¾å‘æ¥è¿‘"

            # è§†è§‰æ˜¾ç¤º
            st.markdown(f"#### {axis_labels[axis]}")
            progress = left_score / (left_score + right_score)
            st.progress(progress)
            st.write(f"{left_key}: {left_score}  vs  {right_key}:   {right_score} â€”â€” {tendency_label}")
            st.markdown("---")

