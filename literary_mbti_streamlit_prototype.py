# literary_mbti_streamlit_full.py
# Streamlit app for "æ–‡å­¦ MBTI" questionnaire with full questions and 16 profiles
# Run: streamlit run literary_mbti_streamlit_full.py

import streamlit as st
import pandas as pd
import json
from datetime import datetime

st.set_page_config(page_title="æ–‡å­¦ MBTI æµ‹è¯•", layout="centered")

# ------------------------------------
# é¢˜ç›®é…ç½®ï¼šæ¥è‡ªä½ çš„ DOCX æ–‡ä»¶ï¼ˆæ¯ç»´åº¦ 5 é¢˜ï¼‰
# ------------------------------------
QUESTIONS = []

def add_questions(axis, qlist):
    for i, (text, A, B) in enumerate(qlist, 1):
        QUESTIONS.append({
            "id": f"{axis}{i}",
            "text": text,
            "axis": axis,
            "options": [(A, axis[0]), (B, axis[1])]
        })

# ç„¦ç‚¹å–å‘ - æƒ…èŠ‚é©±åŠ¨ (E) vs. å†…å¿ƒä¸–ç•Œ (I)
add_questions("EI", [
    ("å½“ä½ å‘æœ‹å‹æ¨èä¸€æœ¬ä¹¦æ—¶ï¼Œä½ æœ€å…ˆæè¿°çš„æ˜¯ä»€ä¹ˆï¼Ÿ", "æƒ…èŠ‚å¤šä¹ˆæ›²æŠ˜ç¦»å¥‡", "è§’è‰²å†…å¿ƒæŒ£æ‰å¤šä¹ˆæ·±åˆ»"),
    ("ä»€ä¹ˆæ ·çš„å†²çªæ›´èƒ½å¸å¼•ä½ ï¼Ÿ", "å¤–éƒ¨å¯¹æŠ—ã€æˆ˜äº‰æˆ–è¿½æ•", "äººç‰©å†…åœ¨çš„é“å¾·å›°å¢ƒ"),
    ("ä¼Ÿå¤§å°è¯´çš„æ ¸å¿ƒé©±åŠ¨åŠ›æ˜¯ä»€ä¹ˆï¼Ÿ", "æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ", "è¿™ä¸ªäººä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ"),
    ("å‰50é¡µéƒ½æ˜¯æ—¥å¸¸æå†™ï¼Œä½ ä¼šï¼Ÿ", "æ„Ÿåˆ°ä¹å‘³ï¼ŒæœŸå¾…äº‹ä»¶å‘ç”Ÿ", "äº«å—ç»†èŠ‚ï¼Œç†è§£äººç‰©ç”Ÿæ´»"),
    ("ä½ æ›´å–œæ¬¢ä»€ä¹ˆæ ·çš„å™äº‹èŠ‚å¥ï¼Ÿ", "ç´§å‡‘è¿…æ·ï¼Œä¿¡æ¯é‡å¤§", "èˆ’ç¼“æ·±å…¥ï¼Œåœç•™åœ¨æƒ…ç»ªä¸­"),
])

# é£æ ¼å–å‘ - ç°å®ä¸»ä¹‰ (S) vs. æƒ³è±¡ä¸»ä¹‰ (N)
add_questions("SN", [
    ("ä»€ä¹ˆæ ·çš„æ–°ä¸–ç•Œæ›´è®©ä½ å…´å¥‹ï¼Ÿ", "çœŸå®å­˜åœ¨çš„å†å²æ—¶ä»£", "å®Œå…¨è™šæ„çš„ä¸–ç•Œ"),
    ("ä»€ä¹ˆæ ·çš„æ¯”å–»æ›´æ‰“åŠ¨ä½ ï¼Ÿ", "å¸¸è§äº‹ç‰©çš„ç²¾å¦™ç±»æ¯”", "æŠ½è±¡è€Œå¯Œæœ‰æƒ³è±¡åŠ›çš„è”ç»“"),
    ("å¦‚ä½•çœ‹å¾…é­”æ³•æˆ–è¶…ç°å®å…ƒç´ ï¼Ÿ", "ä¼šåˆ†æ•£æ³¨æ„åŠ›", "æ˜¯è¡¨è¾¾æ€æƒ³çš„éšå–»å·¥å…·"),
    ("é˜…è¯»æ—¶ï¼Œä»€ä¹ˆæ ·çš„ç»†èŠ‚æœ€è®©ä½ ä¿¡æœï¼Ÿ", "çœŸå®çš„ç¤¾ä¼šç»†èŠ‚", "è™šæ„ä¸–ç•Œè§‚çš„è‡ªæ´½æ€§"),
    ("å¦‚æœä¸€æœ¬ä¹¦è¢«è¯„ä»·ä¸ºæ–‡ç¬”è¯—æ„ï¼Œä½ ä¼šï¼Ÿ", "æ‹…å¿ƒçŸ«æ‰é€ ä½œ", "æœŸå¾…å…¶ç¾æ„Ÿ"),
])

# å†³ç­–å–å‘ - é€»è¾‘æ¶æ„ (T) vs. æƒ…æ„Ÿå…±é¸£ (F)
add_questions("TF", [
    ("ä¸€ä¸ªè§’è‰²çš„è¡Œä¸ºï¼Œä½ æ›´çœ‹é‡ä»€ä¹ˆï¼Ÿ", "é€»è¾‘åˆç†", "æƒ…æ„Ÿå†²å‡»"),
    ("ä»€ä¹ˆæ ·çš„ä¸»é¢˜æ›´èƒ½å¼•å‘ä½ çš„æ€è€ƒï¼Ÿ", "å“²å­¦æ¢è®¨", "æƒ…æ„Ÿå‘½é¢˜"),
    ("å¦‚ä½•åˆ¤æ–­åæ´¾æ˜¯å¦æˆåŠŸï¼Ÿ", "åŠ¨æœºæ¸…æ™°ä¸”æ¨åŠ¨å‰§æƒ…", "è®©äººç†è§£å…¶ç—›è‹¦"),
    ("è¯»å®Œä¸€æœ¬ä¹¦åï¼Œä½ å€¾å‘è®¨è®ºä»€ä¹ˆï¼Ÿ", "å™äº‹ç»“æ„ä¸æ€æƒ³", "äººç‰©å‘½è¿ä¸æ„Ÿå—"),
    ("ç»“å±€åˆç†æ„å‘³ç€ä»€ä¹ˆï¼Ÿ", "é€»è¾‘å¿…ç„¶", "æƒ…æ„Ÿåœ†æ»¡"),
])

# æ€åº¦å–å‘ - é—­åˆç»“å±€ (J) vs. å¼€æ”¾è¯ é‡Š (P)
add_questions("JP", [
    ("çœ‹åˆ°å¹¸ç¦ç”Ÿæ´»ç»“å°¾ï¼Œä½ æ„Ÿè§‰å¦‚ä½•ï¼Ÿ", "æ»¡æ„å®‰å¿ƒ", "æƒ³çŸ¥é“æ›´å¤šæŒ‘æˆ˜"),
    ("é¢å¯¹å¯å¤šé‡è§£è¯»çš„å°è¯´ï¼Œä½ è®¤ä¸ºï¼Ÿ", "ä½œè€…æ„å›¾ä¸æ¸…", "æ–‡å­¦çš„é­…åŠ›æ‰€åœ¨"),
    ("æ›´å–œæ¬¢å“ªç§å™äº‹ç»“æ„ï¼Ÿ", "çº¿æ€§å™äº‹", "ç¢ç‰‡åŒ–å¤šè§†è§’å™äº‹"),
    ("ç»“å±€æ˜¯ä¸»è§’èµ°å‘æœªçŸ¥æœªæ¥æ—¶ï¼Œä½ ä¼šï¼Ÿ", "å¤±è½ï¼Œæƒ³è¦ç¡®å®šç­”æ¡ˆ", "å…´å¥‹ï¼Œæƒ³è±¡å„ç§æœªæ¥"),
    ("æ•…äº‹ç»“å°¾çš„ä½œç”¨ï¼Ÿ", "æ”¶æŸä¸äº¤ä»£", "å¼€å¯æ–°çš„æ€è€ƒ"),
])

# ------------------------------------
# MBTI ç»“æœæ•°æ®ï¼š16å‹æè¿° + æ¨èä¹¦å•
# ------------------------------------
MBTI_PROFILES = {
    "ESTJ": {"title": "æ¶æ„è§£å¯†è€…", "description": "ç—´è¿·æƒ…èŠ‚é€»è¾‘é—­ç¯ï¼Œå–œæ¬¢æ‰æ ¹ç°å®ã€æ— æ¼æ´çš„æ•…äº‹ã€‚", "books": ["ã€Šæ¸…æ˜ä¸Šæ²³å›¾å¯†ç ã€‹", "ã€Šä¸œæ–¹å¿«è½¦è°‹æ€æ¡ˆã€‹", "ã€Šåå°å­©ã€‹"]},
    "ENTJ": {"title": "ä¸–ç•Œè§„åˆ™æŒæ§è€…", "description": "äº«å—è™šæ„ä¸–ç•Œçš„ä¸¥è°¨é€»è¾‘ï¼Œå–œæ¬¢å®Œæ•´è®¾å®šä¸æ¸…æ™°ç»“å±€ã€‚", "books": ["ã€Šä¸‰ä½“ã€‹", "ã€ŠåŸºåœ°ã€‹", "ã€Šæ²™ä¸˜ã€‹"]},
    "ISTJ": {"title": "äººæ€§é€»è¾‘è§‚å¯Ÿè€…", "description": "å…³æ³¨ç°å®äººç‰©å¿ƒç†é€»è¾‘ï¼Œäººç‰©å¿ƒç†è½¬å˜å¿…é¡»ç¬¦åˆç°å®é€»è¾‘ã€‚", "books": ["ã€Šæ´»ç€ã€‹", "ã€ŠåŒ…æ³•åˆ©å¤«äººã€‹", "ã€Šäººä¸–é—´ã€‹"]},
    "INTJ": {"title": "éšå–»é€»è¾‘è§£è¯»å¸ˆ", "description": "å–œæ¬¢è™šæ„å¤–å£³ä¸‹çš„å¿ƒç†é€»è¾‘å‰–æï¼Œè¿½æ±‚éšå–»ä¸è‡ªæˆ‘å’Œè§£ã€‚", "books": ["ã€Šå…‹æ‹‰æ‹‰ä¸å¤ªé˜³ã€‹", "ã€Šå¤±æ˜ç—‡æ¼«è®°ã€‹", "ã€Šè‡ç‹ã€‹"]},
    "ESTP": {"title": "ç°å®è°œé¢˜æ¢ç´¢è€…", "description": "äº«å—ç°å®æƒ…èŠ‚çš„é€»è¾‘ç•™ç™½ï¼Œé€šè¿‡æ¨ç†æ¢ç´¢äººæ€§ã€‚", "books": ["ã€Šç™½å¤œè¡Œã€‹", "ã€Šå±€å¤–äººã€‹", "ã€Šé•¿å¤œéš¾æ˜ã€‹"]},
    "ENTP": {"title": "è®¾å®šè°œé¢˜æ€è¾¨è€…", "description": "åçˆ±è™šæ„è®¾å®šçš„é€»è¾‘å»¶ä¼¸ï¼Œå¼•å‘å“²å­¦æ€è¾¨ã€‚", "books": ["ã€Šä½ ä¸€ç”Ÿçš„æ•…äº‹ã€‹", "ã€Šç¯å½¢ä½¿è€…ã€‹", "ã€Šé»‘æš—çš„å·¦æ‰‹ã€‹"]},
    "ISTP": {"title": "äººæ€§æ€è€ƒè€…", "description": "å…³æ³¨ç°å®äººç‰©å¿ƒç†ç•™ç™½ï¼Œé€šè¿‡ç»†èŠ‚å¼•å‘äººæ€§æ€è€ƒã€‚", "books": ["ã€ŠæŒªå¨çš„æ£®æ—ã€‹", "ã€Šæ–¯é€šçº³ã€‹", "ã€Šå±±èŒ¶æ–‡å…·åº—ã€‹"]},
    "INTP": {"title": "éšå–»å¿ƒç†æ€è¾©è€…", "description": "å–œæ¬¢è™šæ„éšå–»çš„å¿ƒç†ç•™ç™½ï¼Œé€šè¿‡éšå–»æ€è¾¨å†…å¿ƒã€‚", "books": ["ã€Šæµ·æµªã€‹", "ã€Šæ ‘ä¸Šçš„ç”·çˆµã€‹", "ã€Šä½©å¾·ç½—Â·å·´æ‹‰è«ã€‹"]},
    "ESFJ": {"title": "ç°å®æƒ…æ„Ÿè¿½éšè€…", "description": "æ²‰è¿·ç°å®æƒ…èŠ‚ä¸­çš„æƒ…æ„Ÿé—­ç¯ï¼Œå–œæ¬¢æƒ…æ„Ÿå®‰æ”¾çš„ç»“å±€ã€‚", "books": ["ã€Šå¹³å‡¡çš„ä¸–ç•Œã€‹", "ã€Šå±±èŒ¶æ–‡å…·åº—ã€‹", "ã€Šå¤ºå®å¥‡å…µã€‹"]},
    "ENFJ": {"title": "å¥‡å¹»æƒ…æ„Ÿå®ˆæŠ¤è€…", "description": "äº«å—è™šæ„æƒ…èŠ‚ä¸­çš„æƒ…æ„Ÿåœ†æ»¡ï¼Œæƒ…æ„Ÿè”ç»“ä¸ºæ ¸å¿ƒã€‚", "books": ["ã€Šéœæ¯”ç‰¹äººã€‹", "ã€Šå°‘å¹´Piçš„å¥‡å¹»æ¼‚æµã€‹", "ã€Šæ˜Ÿå°˜ã€‹"]},
    "ISFJ": {"title": "äººé—´æ¸©æƒ…è®°å½•è€…", "description": "æ²‰é†‰ç°å®æ—¥å¸¸é‡Œçš„æƒ…æ„Ÿæ²‰æ·€ï¼Œæ³¨é‡ç”Ÿæ´»çš„æ¸©æƒ…ã€‚", "books": ["ã€Šä½è´ºçš„è¶…çº§é˜¿å¬·ã€‹", "ã€Šæ·±å¤œé£Ÿå ‚ã€‹", "ã€Šæˆ‘ä»¬ä»¨ã€‹"]},
    "INFJ": {"title": "å¥‡å¹»å¿ƒçµæ²»æ„ˆè€…", "description": "åçˆ±è™šæ„è®¾å®šä¸‹çš„æƒ…æ„Ÿå’Œè§£ï¼Œçœ‹é‡å¿ƒçµåœ†æ»¡ã€‚", "books": ["ã€Šå°ç‹å­ã€‹", "ã€Šæµ·æ´‹ä¹‹æ­Œã€‹", "ã€Šä½ åœ¨å¤©å ‚é‡Œé‡è§çš„äº”ä¸ªäººã€‹"]},
    "ESFP": {"title": "ç°å®æƒ…æ„Ÿæ¼«æ¸¸è€…", "description": "äº«å—ç°å®æƒ…èŠ‚ä¸­çš„æƒ…æ„Ÿåˆ‡ç‰‡ï¼Œå…³æ³¨å³æ—¶ä½“éªŒã€‚", "books": ["ã€Šæ¼«é•¿çš„å‘Šåˆ«ã€‹", "ã€Šå¥¥å‰Â·é©¬å¥‡å†é™©è®°ã€‹", "ã€Šé£è¡Œå®¶ã€‹"]},
    "ENFP": {"title": "å¥‡å¹»æƒ…æ„Ÿæ¢ç´¢è€…", "description": "ç—´è¿·è™šæ„æƒ…èŠ‚ä¸­çš„æƒ…æ„Ÿå¯èƒ½ï¼Œè¿½æ±‚æƒ…æ„Ÿæ–°é²œæ„Ÿã€‚", "books": ["ã€Šé“¶æ²³ç³»æ¼«æ¸¸æŒ‡å—ã€‹", "ã€Šçˆ±ä¸½ä¸æ¢¦æ¸¸ä»™å¢ƒã€‹", "ã€Šå¤œæ™šçš„æ½œæ°´è‰‡ã€‹"]},
    "ISFP": {"title": "ç”Ÿæ´»æƒ…ç»ªæ•æ‰è€…", "description": "å…³æ³¨ç°å®æ—¥å¸¸é‡Œçš„æƒ…æ„Ÿä½™éŸµï¼Œç»†è…»ä½“éªŒæƒ…ç»ªã€‚", "books": ["ã€Šå¤éƒ½ã€‹", "ã€Šæƒ…äººã€‹", "ã€Šç§‹å›­ã€‹"]},
    "INFP": {"title": "å¹»æ¢¦æƒ…æ„Ÿæ²‰æ€è€…", "description": "æ²‰é†‰è™šæ„æ„è±¡é‡Œçš„æƒ…æ„Ÿå“²æ€ï¼Œæ€è€ƒæƒ…æ„Ÿä¸æ€æƒ³ã€‚", "books": ["ã€Šæµ·æµªã€‹", "ã€Šé˜¿è±å¤«ã€‹", "ã€Šä½©å¾·ç½—Â·å·´æ‹‰è«ã€‹"]},
}

# ------------------------------------
# è®¡ç®—å‡½æ•°
# ------------------------------------

def compute_mbti(answers):
    axis_map = {"EI": {"E": 0, "I": 0}, "SN": {"S": 0, "N": 0}, "TF": {"T": 0, "F": 0}, "JP": {"J": 0, "P": 0}}
    for q in QUESTIONS:
        val = answers.get(q['id'])
        if val in axis_map[q['axis']]:
            axis_map[q['axis']][val] += 1
    mbti = ''.join([
        'E' if axis_map['EI']['E'] >= axis_map['EI']['I'] else 'I',
        'S' if axis_map['SN']['S'] >= axis_map['SN']['N'] else 'N',
        'T' if axis_map['TF']['T'] >= axis_map['TF']['F'] else 'F',
        'J' if axis_map['JP']['J'] >= axis_map['JP']['P'] else 'P',
    ])
    return mbti, axis_map

# ------------------------------------
# UI éƒ¨åˆ†
# ------------------------------------

st.title("ğŸ“š æ–‡å­¦ MBTI æµ‹è¯•")
st.write("å›ç­”ä»¥ä¸‹ 20 ä¸ªé—®é¢˜ï¼Œçœ‹çœ‹ä½ æ˜¯å“ªç§æ–‡å­¦ç±»å‹ï¼")

with st.form(key='mbti_form'):
    answers = {}
    cnt=0;
    for q in QUESTIONS:
        cnt+=1
        st.write(f"**{cnt}.{q['text']}**")
        choice = st.radio("", [opt[0] for opt in q['options']], key=q['id'], horizontal=True)
        chosen_value = dict(q['options'])[choice]
        answers[q['id']] = chosen_value
        st.divider()
    submitted = st.form_submit_button("æäº¤å¹¶æŸ¥çœ‹ç»“æœ")

if submitted:
    mbti, breakdown = compute_mbti(answers)
    st.success(f"ä½ çš„æ–‡å­¦ MBTI ç±»å‹æ˜¯ï¼š**{mbti}**")

    profile = MBTI_PROFILES.get(mbti)
    if profile:
        st.header(profile['title'])
        st.write(profile['description'])
        st.write("**æ¨èä¹¦ç›®ï¼š**")
        for book in profile['books']:
            st.write(f"- {book}")
    else:
        st.warning("æš‚æ— è¯¥ç±»å‹çš„è¯¦ç»†ä¿¡æ¯ã€‚")

    st.write("---")
    st.write("**ç»´åº¦è®¡åˆ†ï¼š**")
    st.dataframe(pd.DataFrame([{k: v for k,v in breakdown[axis].items()} for axis in breakdown]))
